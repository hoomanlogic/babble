!function(t){"use strict";var e=function(t){return t.hasOwnProperty("toString")?t.toString():t},n=function(t,e,n){var s=0,a=e.pos;"undefined"!=typeof n&&null!==n&&(s=n.pos+n.text.length);for(var r=0,o=null,r=0;r<t.length;r++)if(s<=t[r].pos&&t[r].pos<a)o=t[r];else if(t[r].pos>=a)break;return o};t.getTokenModifier=n;var s=function(t,e){if(0===t.length||t[t.length-1].pos<e.pos)t.push(e);else for(var n=0;n<t.length;n++){if(t[n].pos>e.pos){t.splice(n,0,e);break}if(t[n].pos===e.pos&&t[n].len<e.len){t.splice(n,1,e);break}}};t.insertToken=s;var a=function(t,e,n){this.input=t,this.tokens=e,this.preParsedResults=n||null};a.prototype={toString:function(){for(var t=this.input,n=0;n<this.tokens.length;n++)t=t.slice(0,this.tokens[n].pos)+e(this.tokens[n].value)+t.slice(this.tokens[n].pos+this.tokens[n].text.length);return t}};var r=function(t,e,n,s,a,r){this.value=t,this.kind=e,this.pos=n,this.text=s,this.tokens=a||[],this.certainty=r||0},o=function(t,e){if(!this.hasOwnProperty("name")||"string"!=typeof this.name||!this.hasOwnProperty("parse")||"function"!=typeof this.parse||"function Object() { [native code] }"===this.constructor.toString())throw new Error('BaseTranslator must be inheritied and properties set for "name" and "parse"');if("undefined"==typeof i[this.name])throw new Error('"'+this.name+'" must be registered before it is instantiated');if(this.locale=e||i[this.name].defaultLocale,-1===i[this.name].supportedLocales.indexOf(this.locale))throw new Error('Locale "'+this.locale+'" is not supported by "'+this.name+'"');this.onTranslate=t||null,this.hasOwnProperty("assistants")||(this.assistants=[])};o.prototype={listen:function(t,e,n,s){if("string"==typeof t&&document&&document.getElementById&&(t=document.getElementById(t)),e=e||"input",n=n||this.onTranslate,t.addEventListener)t.addEventListener(e,this.translate.bind(this,{speaker:t,locale:s,onTranslate:n}));else if(t.attachEvent)t.attachEvent("on"+e,this.translate.bind(this,{speaker:t,locale:s,onTranslate:n}));else if("undefined"!=typeof t["on"+e])t["on"+e]=this.translate.bind(this,{speaker:t,locale:s,onTranslate:n});else{if("undefined"==typeof t[e])throw new Error("Could not find an appropriate event to bind to");t[e]=this.translate.bind(this,{speaker:t,locale:s,onTranslate:n})}},translate:function(){for(var t=null,e={locale:this.locale,onTranslate:null,speaker:null},n=0;n<arguments.length;n++)if("string"==typeof arguments[n])arguments[n].length<6&&-1!==i[this.name].supportedLocales.indexOf(arguments[n])?e.locale=arguments[n]:null===t&&(t=arguments[n]);else if("object"==typeof arguments[n])if("undefined"!=typeof arguments[n].target&&"undefined"!=typeof arguments[n].target.value)t=arguments[n].target.value;else for(var s in arguments[n])arguments[n].hasOwnProperty(s)&&(e[s]=arguments[n][s]);else"function"==typeof arguments[n]&&(e.onTranslate=arguments[n]);if(t){var a=this.parse(t,e.locale);return null!==e.onTranslate&&e.onTranslate(a,e.speaker),this.onTranslate&&this.onTranslate(a,e.speaker),a}throw new Error("translate function was not given an appropriate input to parse")},passToAssistants:function(t,e){for(var n={},s=0;s<this.assistants.length;s++)n[this.assistants[s]]=u(this.assistants[s]).parse(t,e);return n}},t.ParsedResult=a,t.BaseTranslator=o,t.Token=r;var i={},l=function(t,e,n,s){i[t]={instance:null,defaultLocale:n,supportedLocales:s},i[t].instance=new e};t.register=l;var u=function(t,e){if(e=e||i[t].instance.locale,-1===i[t].supportedLocales.indexOf(e))throw new Error('Locale "'+this.locale+'" is not supported by "'+t+'"');return i[t].locale=e||i[t].instance.locale,i[t].instance};t.get=u;var p=function(t,e){var n=null,s=null,a=null;if(arguments.length<3||"function"!=typeof arguments[arguments.length-1])throw new TypeError("Unexpected number of arguments");a=arguments[arguments.length-1],arguments.length>3&&(n=arguments[2]),arguments.length>4&&(s=arguments[3]);var r=u(t,s);r.listen(e,n,a,s)};t.assign=p}("undefined"==typeof exports?this.babble=this.babble||{}:exports);
!function(t){"use strict";var e=function(t){return t.hasOwnProperty("toString")?t.toString():t},n=function(t,e){var n=null,s=null,r=null;if(arguments.length<3||"function"!=typeof arguments[arguments.length-1])throw new TypeError("Unexpected number of arguments");r=arguments[arguments.length-1],arguments.length>3&&(n=arguments[2]),arguments.length>4&&(s=arguments[3]);var a=h(t,s);a.listen(e,n,r)},s=function(t,e,n){var s=0,r=e.pos;"undefined"!=typeof n&&null!==n&&(s=n.pos+n.text.length);for(var a=0,i=null,a=0;a<t.length;a++)if(s<=t[a].pos&&t[a].pos<r)i=t[a];else if(t[a].pos>=r)break;return i},r=function(t,e){if(0===t.length||t[t.length-1].pos<e.pos)t.push(e);else for(var n=0;n<t.length;n++){if(t[n].pos>e.pos){t.splice(n,0,e);break}if(t[n].pos===e.pos&&t[n].len<e.len){t.splice(n,1,e);break}}},a=function(t,e,n,s){this.input=t,this.tokens=e,this.preParsedOutput=n||null,this.preParsedResults=s||null};a.prototype={digify:function(){for(var t=this.preParsedOutput||this.input,n=0;n<this.tokens.length;n++)t=t.replace(this.tokens[n].text,e(this.tokens[n].value));return t}};var i=function(t,e,n,s,r,a){this.value=t,this.kind=e,this.pos=n,this.text=s,this.tokens=r||[],this.certainty=a||0},o=function(t,e){if(!this.hasOwnProperty("name")||"string"!=typeof this.name||!this.hasOwnProperty("parse")||"function"!=typeof this.parse||"function Object() { [native code] }"===this.constructor.toString())throw new Error('BaseTranslator must be inheritied and properties set for "name" and "parse"');if("undefined"==typeof u[this.name])throw new Error('"'+this.name+'" must be registered before it is instantiated');if(this.locale=e||u[this.name].defaultLocale,-1===u[this.name].supportedLocales.indexOf(this.locale))throw new Error('Locale "'+this.locale+'" is not supported by "'+this.name+'"');this.onTranslate=t||null,this.hasOwnProperty("assistants")||(this.assistants=[])};o.prototype={listen:function(t,e,n){if("string"==typeof t&&document&&document.getElementById&&(t=document.getElementById(t)),e=e||"input",n=n||this.onTranslate,t.addEventListener)t.addEventListener(e,this.translate.bind(this,t,n));else if(t.attachEvent)t.attachEvent("on"+e,this.translate.bind(this,t,n));else if("undefined"!=typeof t["on"+e])t["on"+e]=this.translate.bind(this,t,n);else{if("undefined"==typeof t[e])throw new Error("Could not find an appropriate event to bind to");t[e]=this.translate.bind(this,t,n)}},translate:function(){var t=arguments.length,e=this.locale;-1!==u[this.name].supportedLocales.indexOf(arguments[arguments.length-1])&&(t=arguments.length-1,e=arguments[t]);var n="",s=t-1;if("string"==typeof arguments[s]?n=arguments[s]:arguments[s]&&arguments[s].target&&arguments[s].target.value&&(n=arguments[s].target.value),n){var r=this.parse(n,e);return arguments.length>2&&"function"==typeof arguments[1]?arguments[1](r,arguments[0]):this.onTranslate&&arguments.length>1&&"string"!=typeof arguments[0]&&this.onTranslate(r,arguments[0]),r}},passToAssistants:function(t,e){for(var n=t,s={},r=0;r<this.assistants.length;r++)s[this.assistants[r]]=h(this.assistants[r]).parse(n,e),n=s[this.assistants[r]].digify();return{preParsedOutput:n,preParsedResults:s}}},t.ParsedResult=a,t.BaseTranslator=o,t.Token=i;var u={},l=function(t,e,n,s){u[t]={instance:null,defaultLocale:n,supportedLocales:s},u[t].instance=new e};t.register=l;var h=function(t,e){if(e=e||u[t].instance.locale,-1===u[t].supportedLocales.indexOf(e))throw new Error('Locale "'+this.locale+'" is not supported by "'+t+'"');return u[t].locale=e||u[t].instance.locale,u[t].instance};t.get=h,t.assign=n,t.getTokenModifier=s,t.insertToken=r}("undefined"==typeof exports?this.babble=this.babble||{}:exports);